
{% extends "loginapp/base.html" %}

{% block title %}Посещение{% endblock %}

{% block content %}

<div class="admin-page">
  <form method="GET" action="{% url 'admin' %}" class="form-table">
     <select name="users">
  <option value="">Выберите пользователя</option>
  {% for user in form.users.field.queryset %}
    <option value="{{ user.username }}">{{ user.last_name }}</option>
  {% endfor %}
</select>

    <input type="text" name="search" placeholder="Поиск по имени или дате" value="{{ request.GET.search }}">
    <input type="date" name="date" value="{{ request.GET.date }}">
    <button type="submit">Поиск</button>
  </form>
{{ formset.errors }}  {{ formset.non_field_errors }}  {{ form.errors }}  {{ form.non_field_errors }}


  <table>
    <thead>
      <tr>
        <th><div>Имя</div> <img src="/media/icons/sort.png" width="30px"></th>
        <th><div>Фамилия</div> <img src="/media/icons/sort.png" width="30px"></th>
        <th><div>Дата</div> <img src="/media/icons/sort.png"width="30px"></th>
        <th><div>Время входа (опоздание)</div><img src="/media/icons/sort.png" width="30px"></th>
      </tr>
    </thead>
    <tbody>
      {% for item in visits %}
      <tr>
        <td>{{ item.user.first_name }}</td>
        <td>{{item.user.last_name}}</td>
        <td>{{ item.date }}</td>
        <td class="time">{{ item.time|time:"H:i" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{{temp}}
{% endblock %}
<script>
const timeCellAll = document.querySelectorAll(".time");

timeCellAll.forEach(timeCell => {
  const timeValue = timeCell.textContent;
  const [hours, minutes] = timeValue.split(":").map(Number);

  const lateMinutes = (hours - 9) * 60 + minutes;

  if (lateMinutes > 0) {
    const updatedTimeValue = `${timeValue} (${formatLateMinutes(lateMinutes)})`;
    timeCell.textContent = updatedTimeValue;
  }
});

function formatLateMinutes(minutes) {
  const hours = Math.floor(minutes / 60);
  const remainingMinutes = minutes % 60;
  return `${hours}:${remainingMinutes.toString().padStart(2, "0")}`;
}

</script>

</body>
</html>