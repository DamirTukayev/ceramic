{% extends "loginapp/base.html" %}

{% block title %}Посещение{% endblock %}

{% block content %}
<div class="admin-page">
  <form method="GET" action="{% url 'admin' %}" class="form-table">
    <input type="text" name="search" placeholder="Поиск по имени или дате" value="{{ request.GET.search }}">
    <input type="date" name="date" value="{{ request.GET.date }}">
    <button type="submit">Поиск</button>
  </form>
  
  <table>
    <thead>
      <tr>
        <th>Имя</th>
        <th>Фамилия</th>
        <th>дата</th>
        <th>Время входа (опоздание)</th>
      </tr>
    </thead>
    <tbody>
      {% for item in visits %}
      <tr>
        <td>{{ item.user.first_name }}</td>
        <td>{{item.user.last_name}}</td>
        <td>{{ item.date }}</td>
        <td class="time">{{ item.time|time:"H:i" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
const timeCellAll = document.querySelectorAll(".time");

timeCellAll.forEach(timeCell => {
  const timeValue = timeCell.textContent;
  const [hours, minutes] = timeValue.split(":").map(Number);

  const lateMinutes = (hours - 10) * 60 + minutes;

  if (lateMinutes > 0) {
    const updatedTimeValue = `${timeValue} (${formatLateMinutes(lateMinutes)})`;
    timeCell.textContent = updatedTimeValue;
  }
});

function formatLateMinutes(minutes) {
  const hours = Math.floor(minutes / 60);
  const remainingMinutes = minutes % 60;
  return `${hours}:${remainingMinutes.toString().padStart(2, "0")}`;
}

</script>

{% endblock %}

